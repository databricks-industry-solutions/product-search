resources:
  variables:
    job_name:
      default: "[Solution Accelerator] Product Search"
    solacc_path:
      description: Root path of the solution accelerator in Workspace File System
    node_type:
      description: Node type id appropriate for the cloud
    
  jobs:
    product_search:
      name: "${var.job_name}"
      timeout_seconds: 28800
      max_concurrent_runs: 1
      tags:
        usage: solacc_testing
        group: RCG
        accelerator: prod_search
      tasks:
      - job_cluster_key: prod_search_cluster
        notebook_task:
          notebook_path: ${var.solacc_path}/00_Intro_and_Config
        task_key: prod_search_00
      - job_cluster_key: prod_search_cluster
        notebook_task:
          notebook_path: ${var.solacc_path}/01_Data_Prep
        task_key: prod_search_01
        depends_on:
        - task_key: prod_search_00
      - job_cluster_key: prod_search_cluster
        notebook_task:
          notebook_path: ${var.solacc_path}/02_Define_Basic_Search
        task_key: prod_search_02
        depends_on:
        - task_key: prod_search_01
      - job_cluster_key: prod_search_cluster
        notebook_task:
          notebook_path: ${var.solacc_path}/03_Fine_Tune_Model
        task_key: prod_search_03
        depends_on:
        - task_key: prod_search_02
      - job_cluster_key: prod_search_cluster
        notebook_task:
          notebook_path: ${var.solacc_path}/04_Deploy_Model
        task_key: prod_search_04
        depends_on:
        - task_key: prod_search_03
      job_clusters:
      - job_cluster_key: prod_search_cluster
        new_cluster:
          spark_version: 12.2.x-gpu-ml-scala2.12
          spark_conf:
            spark.master: local[*, 4]
            spark.databricks.cluster.profile: singleNode
            spark.databricks.delta.preview.enabled: 'true'
          num_workers: 0
          node_type_id: ${var.node_type}
          custom_tags:
            usage: solacc_testing

environments:
  development:
    resources:
      jobs:
        product_search:
          schedule:
            quartz_cron_expression: 14 0 0 * * ?
            timezone_id: UTC